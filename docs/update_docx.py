import sys
sys.stdout.reconfigure(encoding='utf-8')
from docx import Document
from docx.shared import Pt
from docx.enum.text import WD_ALIGN_PARAGRAPH

doc_path = r'C:\Users\Iurii\Downloads\ХОМЕНКО_521_МАГІСТЕРСЬКА_UPDATED.docx'
output_path = r'C:\Users\Iurii\Downloads\ХОМЕНКО_521_МАГІСТЕРСЬКА_UPDATED2.docx'

doc = Document(doc_path)

# Descriptions for figures in sections 3.2-3.4
figure_descriptions_32_34 = {
    'Рисунок 3.1. Діаграма перцедентів': 'Діаграма прецедентів (Use Case Diagram) відображає функціональні можливості системи електронної комерції з точки зору взаємодії користувачів. На діаграмі представлено три основні актори: незареєстрований відвідувач, зареєстрований клієнт та адміністратор. Незареєстрований відвідувач має доступ до перегляду каталогу товарів, пошуку, фільтрації та перегляду детальної інформації про товари. Зареєстрований клієнт додатково може додавати товари до кошика, оформлювати замовлення, керувати списком бажань, залишати відгуки та переглядати історію замовлень. Адміністратор має розширені права: управління товарами, категоріями, замовленнями, користувачами та перегляд аналітики продажів. Зв\'язки між прецедентами включають відношення розширення (extend) та включення (include), що демонструють залежності між функціями системи.',

    'Рисунок 3.2 – 3.3. Діаграма класів': 'Діаграма класів (Class Diagram) представляє структурну модель системи електронної комерції та відображає основні сутності, їх атрибути, методи та зв\'язки. Центральними класами є: User (користувач з атрибутами email, password, role та методами автентифікації), Product (товар з назвою, описом, ціною, зображеннями та характеристиками), Category (категорія з ієрархічною структурою), Order (замовлення зі статусом, сумою та інформацією про доставку), Cart (кошик покупок), Review (відгук з оцінкою та текстом). Між класами встановлено зв\'язки різних типів: композиція (Order-OrderItem), агрегація (Cart-CartItem), асоціація (User-Order, Product-Review). Діаграма також включає допоміжні класи для адрес доставки, платежів та сповіщень. Кардинальність зв\'язків показує, що один користувач може мати багато замовлень (1..*), товар може належати до кількох категорій (*..*).',

    'Рисунок 3.4. Діаграма пакетів': 'Діаграма пакетів (Package Diagram) демонструє високорівневу архітектуру програмної системи та організацію коду за модулями. Система розділена на три основні шари: презентаційний (Presentation Layer), бізнес-логіки (Business Layer) та доступу до даних (Data Access Layer). Презентаційний шар містить пакети веб-застосунку (Web App) та мобільного додатку (Mobile App), які взаємодіють з API-шлюзом. Шар бізнес-логіки включає пакети: Auth (автентифікація та авторизація), Products (управління товарами), Orders (обробка замовлень), Payments (платіжна система), Notifications (сповіщення), Analytics (аналітика). Шар доступу до даних містить пакети для роботи з базою даних (Database), кешування (Cache) та зовнішніми сервісами (External Services). Стрілки залежностей показують напрямок взаємодії між пакетами, дотримуючись принципу інверсії залежностей.'
}

# Descriptions for each figure in section 3.6
figure_descriptions = {
    'Рисунок 3.5. Головний екран магазину': 'На головному екрані інтернет-магазину представлено основний інтерфейс користувача. У верхній частині розміщено навігаційне меню з категоріями товарів, пошуковий рядок та іконки кошика і профілю користувача. Центральна частина екрану містить банери з актуальними акціями та рекомендовані товари. Нижче відображаються популярні категорії товарів та новинки асортименту. Дизайн виконано у сучасному мінімалістичному стилі з акцентними кольорами для привернення уваги до ключових елементів.',

    'Рисунок 3.6. Застосування фільтрів': 'Екран демонструє функціонал фільтрації товарів. У лівій частині інтерфейсу розміщено панель фільтрів, яка включає фільтрацію за ціновим діапазоном (з можливістю встановлення мінімальної та максимальної ціни), вибір виробника, категорії, наявності на складі та інших характеристик товару. Праворуч відображається сітка відфільтрованих товарів з їх зображеннями, назвами та цінами. Користувач може комбінувати різні фільтри для точного пошуку потрібного товару.',

    'Рисунок 3.7. Застосування карткового лейауту': 'На екрані показано альтернативний спосіб відображення товарів у вигляді карткового лейауту. Кожен товар представлено окремою карткою, що містить зображення продукту, його назву, ціну та кнопку додавання до кошика. Картковий вигляд забезпечує більш наочне представлення товарів та зручну навігацію. Користувач може перемикатися між сітковим та картковим виглядом за допомогою відповідних іконок у верхній частині каталогу.',

    'Рисунок 3.8. Картка товару': 'Картка товару відображає детальну інформацію про окремий продукт у компактному форматі. На картці розміщено головне зображення товару, його назву, ціну (включаючи стару ціну при наявності знижки), рейтинг на основі відгуків користувачів та індикатор наявності на складі. Присутні кнопки для швидкого додавання товару до кошика та до списку бажань. Дизайн картки оптимізовано для зручного сприйняття інформації та швидкого прийняття рішення про покупку.',

    'Рисунок 3.9. Сортування товарів': 'Екран демонструє функціонал сортування товарів у каталозі. Випадаюче меню дозволяє обрати критерій сортування: за популярністю, за ціною (від низької до високої або навпаки), за новизною, за рейтингом або за назвою. Обраний параметр сортування застосовується до всього списку товарів у поточній категорії. Це дозволяє користувачам швидко знаходити товари відповідно до їхніх пріоритетів.',

    'Рисунок 3.10. Сторінка товару': 'Сторінка товару містить повну інформацію про обраний продукт. У верхній частині розміщено галерею зображень з можливістю збільшення та перегляду з різних ракурсів. Праворуч знаходиться блок з назвою товару, ціною, вибором кількості та кнопкою додавання до кошика. Нижче представлено детальний опис товару, технічні характеристики у вигляді таблиці, відгуки покупців з оцінками та блок рекомендованих супутніх товарів.',

    'Рисунок 3.11. Головний екран мобільного додатку': 'Головний екран мобільного додатку адаптовано для зручного використання на смартфонах. У верхній частині розміщено логотип магазину та іконку пошуку. Нижче знаходиться горизонтальна карусель з банерами акцій. Основну частину екрану займає вертикальний список категорій товарів з іконками. У нижній частині розташована панель навігації з іконками головної сторінки, каталогу, кошика, списку бажань та профілю користувача.',

    'Рисунок 3.12. Сортування товарів в мобільному додатку': 'Екран сортування товарів у мобільному додатку представлено у вигляді модального вікна, що з\'являється при натисканні на відповідну кнопку. Список опцій сортування включає: за популярністю, за ціною зростання, за ціною спадання, за новизною та за рейтингом. Обрана опція виділяється кольором або галочкою. Інтерфейс оптимізовано для зручного вибору пальцем на сенсорному екрані.',

    'Рисунок 3.13. Фільтрація товарів в мобільному додатку': 'Екран фільтрації товарів у мобільному додатку відображає повноекранну панель з усіма доступними фільтрами. Фільтри згруповано за категоріями: ціновий діапазон (з повзунками), бренд (з чекбоксами), колір, розмір та інші атрибути. У нижній частині екрану розміщено кнопки "Скинути" для очищення всіх фільтрів та "Застосувати" для відображення відфільтрованих результатів.',

    'Рисунок 3.14. Сторінка контактів в мобільному додатку': 'Сторінка контактів у мобільному додатку містить всю необхідну інформацію для зв\'язку з магазином. Відображено адресу фізичного магазину (за наявності), номери телефонів з можливістю прямого дзвінка при натисканні, електронну пошту та посилання на соціальні мережі. Також присутня інтерактивна карта з розташуванням магазину та графік роботи служби підтримки.',

    'Рисунок 3.15. Сторінка контактів в мобільному додатку': 'Додатковий вигляд сторінки контактів демонструє альтернативне оформлення розділу зв\'язку з магазином. Інтерфейс містить форму зворотного зв\'язку для надсилання повідомлень безпосередньо з додатку, FAQ-секцію з відповідями на поширені запитання та можливість розпочати чат з оператором підтримки в режимі реального часу.',

    'Рисунок 3.15. Сторінка налаштувань в мобільному додатку': 'Сторінка налаштувань у мобільному додатку дозволяє користувачу персоналізувати роботу застосунку. Доступні опції включають: вибір мови інтерфейсу, налаштування push-сповіщень (про акції, статус замовлення, нові надходження), вибір теми оформлення (світла/темна), налаштування конфіденційності та можливість очищення кешу. Також присутні посилання на політику конфіденційності та умови використання.',

    'Рисунок 3.15. Сторінка авторизації в мобільному додатку': 'Сторінка авторизації у мобільному додатку містить форму входу до облікового запису. Представлено текстові поля для введення електронної пошти (або номера телефону) та пароля. Нижче розміщено кнопку "Увійти" та посилання "Забули пароль?" для відновлення доступу. Також доступні альтернативні способи авторизації через соціальні мережі (Google, Facebook) та кнопка переходу до реєстрації нового користувача.',

    'Рисунок 3.16. Еелктронний лист зі сповіщенням про оновлення товарів у кошику': 'Електронний лист зі сповіщенням про залишені товари у кошику демонструє шаблон email-повідомлення, яке надсилається користувачам для нагадування про незавершене замовлення. Лист містить логотип магазину, персоналізоване звернення до клієнта, список товарів у кошику із зображеннями та цінами, загальну суму та помітну кнопку заклику до дії "Завершити покупку". Також може включати промокод на знижку для стимулювання завершення замовлення.'
}

# Process document - insert descriptions after figure captions
in_section_32_34 = False
in_section_36 = False
insertions = []

for i, para in enumerate(doc.paragraphs):
    text = para.text.strip()

    # Check for sections 3.2-3.4
    if text.startswith('3.2') or text.startswith('3.3') or text.startswith('3.4'):
        in_section_32_34 = True
        continue

    if in_section_32_34 and (text.startswith('3.5') or text.startswith('3.6')):
        in_section_32_34 = False

    # Process figures in 3.2-3.4
    if in_section_32_34 and text.startswith('Рисунок 3.'):
        if text in figure_descriptions_32_34:
            insertions.append((i, figure_descriptions_32_34[text]))

    # Section 3.6 (skip - already processed)
    if '3.6 Огляд застосунку' in text:
        in_section_36 = True
        continue

    if in_section_36 and (text.startswith('3.7') or text.startswith('4.') or 'РОЗДІЛ 4' in text or text.startswith('Висновки')):
        break

# Insert descriptions after captions (in reverse order to maintain indices)
print(f'Adding {len(insertions)} descriptions...')

for idx, description in reversed(insertions):
    # Get the paragraph after which to insert
    target_para = doc.paragraphs[idx]

    # Find the parent element and insert after target
    parent = target_para._element.getparent()
    target_index = list(parent).index(target_para._element)

    # Create new paragraph
    new_para = doc.add_paragraph()
    new_para.text = description

    # Set font size to match document style (14pt is common for body text)
    for run in new_para.runs:
        run.font.size = Pt(14)
        run.font.name = 'Times New Roman'

    # Set paragraph alignment
    new_para.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY

    # Move the new paragraph to correct position
    parent.insert(target_index + 1, new_para._element)

# Save the document
doc.save(output_path)
print(f'Document saved to: {output_path}')
