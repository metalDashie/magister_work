# РОЗДІЛ 3. РЕАЛІЗАЦІЯ СИСТЕМИ

## 3.1 Огляд інструментів та засобів для розробки

Реалізація системи електронної комерції FullMag базується на сучасному стеку технологій, що забезпечує високу продуктивність, масштабованість та зручність розробки. У цьому розділі наведено детальний огляд усіх інструментів та засобів, використаних при створенні системи.

### 3.1.1 Архітектура проекту та менеджмент залежностей

**Монорепозиторій (Monorepo)**

Проект організовано як монорепозиторій — єдине сховище коду, що містить усі компоненти системи: веб-застосунок, мобільний застосунок, серверну частину та спільні бібліотеки. Така архітектура забезпечує:
- єдину точку управління версіями коду;
- спрощене повторне використання коду між різними застосунками;
- атомарні коміти, що охоплюють зміни в декількох пакетах;
- централізоване управління залежностями.

**pnpm 10.23.0**

Для управління залежностями використовується pnpm (Performant NPM) — сучасний менеджер пакетів для Node.js. Основні переваги pnpm:
- ефективне використання дискового простору завдяки глобальному сховищу пакетів;
- суворий режим залежностей, що запобігає фантомним залежностям;
- вбудована підтримка монорепозиторіїв через механізм workspaces;
- значно швидша швидкість встановлення пакетів порівняно з npm.

Конфігурація workspaces визначена у файлі `pnpm-workspace.yaml`:
```yaml
packages:
  - apps/*
  - packages/*
  - services/*
```

### 3.1.2 Мова програмування та середовище виконання

**TypeScript 5.3.3**

TypeScript є основною мовою програмування проекту. Це надмножина JavaScript, що додає статичну типізацію. Переваги використання TypeScript:
- раннє виявлення помилок на етапі компіляції;
- покращена підтримка IDE (автодоповнення, рефакторинг);
- самодокументований код завдяки типам;
- підтримка сучасних можливостей ECMAScript.

Базова конфігурація TypeScript (`tsconfig.base.json`):
- Target: ES2020;
- Module: ESNext;
- Strict mode: увімкнено;
- Підтримка декораторів: увімкнено;
- Source maps: увімкнено для налагодження.

**Node.js >= 20.0.0**

Node.js є середовищем виконання для серверної частини та інструментів розробки. Версія 20 LTS забезпечує:
- нативну підтримку ES-модулів;
- покращену продуктивність JavaScript-рушія V8;
- вбудований test runner;
- підтримку watch mode для автоматичного перезавантаження.

### 3.1.3 Серверна частина (Backend)

**NestJS 10.3.0**

NestJS є основним фреймворком для побудови серверної частини. Це прогресивний Node.js-фреймворк для створення ефективних та масштабованих серверних застосунків. Основні характеристики:
- архітектура, натхненна Angular (модулі, контролери, сервіси);
- підтримка TypeScript з коробки;
- ін'єкція залежностей (Dependency Injection);
- модульна структура для кращої організації коду;
- декларативний підхід з використанням декораторів.

Основні модулі NestJS, використані в проекті:

| Модуль | Версія | Призначення |
|--------|--------|-------------|
| @nestjs/common | 10.3.0 | Базові декоратори та утиліти |
| @nestjs/core | 10.3.0 | Ядро фреймворку |
| @nestjs/platform-express | 10.3.0 | Інтеграція з Express.js |
| @nestjs/config | 3.1.1 | Управління конфігурацією |
| @nestjs/jwt | 10.2.0 | JWT-автентифікація |
| @nestjs/passport | 10.0.3 | Стратегії автентифікації |
| @nestjs/websockets | 10.3.0 | WebSocket-підтримка |
| @nestjs/platform-socket.io | 10.3.0 | Socket.io інтеграція |
| @nestjs/bull | 10.0.1 | Черги завдань |
| @nestjs/schedule | 6.0.1 | Планування завдань (cron) |

**Express.js**

Express.js використовується як HTTP-платформа для NestJS. Це мінімалістичний та гнучкий веб-фреймворк для Node.js, що забезпечує:
- обробку HTTP-запитів та відповідей;
- middleware для розширення функціональності;
- маршрутизацію запитів.

### 3.1.4 База даних та ORM

**PostgreSQL 16**

PostgreSQL є основною системою управління базами даних проекту. Це потужна об'єктно-реляційна СУБД з відкритим кодом. Переваги PostgreSQL:
- ACID-сумісність для надійних транзакцій;
- розширена підтримка JSON для гнучкого зберігання даних;
- повнотекстовий пошук;
- підтримка складних запитів та індексів;
- висока масштабованість та продуктивність.

**TypeORM 0.3.19**

TypeORM є Object-Relational Mapping (ORM) бібліотекою для TypeScript та JavaScript. Основні можливості:
- визначення сутностей за допомогою декораторів;
- автоматична генерація схеми бази даних;
- підтримка міграцій для версіонування схеми;
- Query Builder для складних запитів;
- підтримка відношень між сутностями (one-to-one, one-to-many, many-to-many).

У проекті визначено 27 сутностей бази даних:
- User — користувачі системи;
- Product, ProductAttribute — товари та їх атрибути;
- Category, Attribute — категорії та характеристики;
- Cart, CartItem — кошик покупок;
- Order, OrderItem — замовлення;
- Payment — платежі;
- DeliveryAddress — адреси доставки;
- Review, ReviewLike, ReviewReply, ReviewComplaint — система відгуків;
- ChatRoom, ChatMessage — чат підтримки;
- Notification — сповіщення;
- Coupon, CouponUsage — купони та знижки;
- Banner — рекламні банери;
- Wishlist, CompareItem — список бажань та порівняння;
- ReturnRequest — повернення товарів;
- AnalyticsSnapshot — аналітика;
- ImportProfile, ImportHistory — імпорт даних.

### 3.1.5 Кешування та черги завдань

**Redis 7**

Redis використовується як in-memory сховище даних для кешування та черг завдань. Переваги Redis:
- надзвичайно висока швидкість операцій читання/запису;
- підтримка різних структур даних (рядки, хеші, списки, множини);
- механізм pub/sub для повідомлень;
- персистентність даних за потреби.

**Bull 4.12.0**

Bull — бібліотека для управління чергами завдань на основі Redis. Використовується для:
- асинхронної обробки email-сповіщень;
- фонових завдань імпорту даних;
- відкладених операцій (нагадування про покинуті кошики);
- розподілу навантаження.

### 3.1.6 Пошукова система

**Elasticsearch 8.11.0**

Elasticsearch використовується для повнотекстового пошуку товарів. Це розподілена пошукова та аналітична система. Можливості:
- швидкий повнотекстовий пошук;
- нечіткий пошук (fuzzy search) для обробки помилок;
- фасетна фільтрація;
- автодоповнення та підказки;
- масштабування на кілька вузлів.

Інтеграція реалізована через офіційний клієнт `@elastic/elasticsearch 9.2.0`.

### 3.1.7 Веб-застосунок (Frontend)

**Next.js 14.1.0**

Next.js є React-фреймворком для веб-застосунку. Це production-ready фреймворк з підтримкою серверного рендерингу. Ключові можливості:
- Server-Side Rendering (SSR) для SEO-оптимізації;
- Static Site Generation (SSG) для статичних сторінок;
- App Router для маршрутизації;
- API Routes для серверних endpoint'ів;
- автоматична оптимізація зображень;
- вбудована підтримка CSS та Sass.

**React 18.2.0**

React є основною бібліотекою для побудови користувацького інтерфейсу. Особливості версії 18:
- Concurrent Rendering для покращеної відгуку;
- Automatic Batching для оптимізації оновлень;
- Transitions API для плавних переходів;
- Suspense для асинхронного завантаження.

**Tailwind CSS 3.4.1**

Tailwind CSS — utility-first CSS-фреймворк для швидкої розробки інтерфейсів. Переваги:
- низькорівневі утилітарні класи;
- кастомізація через конфігурацію;
- автоматичне видалення невикористаних стилів (PurgeCSS);
- адаптивний дизайн з коробки;
- темна тема та кастомні кольори.

**Zustand 4.5.0**

Zustand використовується для управління станом застосунку. Це легка альтернатива Redux з простим API:
- мінімалістичний розмір бандлу;
- відсутність boilerplate-коду;
- підтримка middleware;
- інтеграція з React DevTools.

**React Hook Form 7.49.3 + Zod 3.22.4**

Для роботи з формами використовується комбінація React Hook Form та Zod:
- декларативна валідація через схеми Zod;
- мінімальні ре-рендери компонентів;
- підтримка складних форм та масивів;
- TypeScript-first підхід до валідації.

**Recharts 3.4.1**

Recharts — бібліотека для візуалізації даних в адмін-панелі:
- побудова графіків та діаграм;
- адаптивність та анімації;
- інтеграція з React-компонентами.

### 3.1.8 Мобільний застосунок

**React Native 0.82.1**

React Native використовується для розробки кросплатформного мобільного застосунку. Переваги:
- єдина кодова база для iOS та Android;
- нативна продуктивність;
- hot reloading для швидкої розробки;
- великий екосистем бібліотек.

**React Navigation 7.x**

React Navigation забезпечує навігацію в мобільному застосунку:

| Модуль | Версія | Призначення |
|--------|--------|-------------|
| @react-navigation/native | 7.1.20 | Базова навігація |
| @react-navigation/bottom-tabs | 7.8.6 | Нижня панель вкладок |
| @react-navigation/stack | 7.6.5 | Стекова навігація |

**Redux Toolkit 2.10.1 + Redux-Persist 6.0.0**

Для управління станом мобільного застосунку використовується Redux Toolkit:
- централізоване сховище стану;
- Redux-Persist для збереження стану між сесіями;
- інтеграція з react-native-mmkv для шифрованого сховища.

**react-native-mmkv 3.1.0**

MMKV — високопродуктивне key-value сховище від WeChat:
- швидкість в 30 разів вища за AsyncStorage;
- підтримка шифрування;
- синхронний API.

**Додаткові бібліотеки мобільного застосунку:**
- react-native-gesture-handler 2.29.1 — обробка жестів;
- react-native-screens 4.18.0 — нативні екрани;
- react-native-safe-area-context 5.6.2 — безпечні зони;
- react-native-vector-icons 10.3.0 — іконки.

### 3.1.9 Комунікація в реальному часі

**Socket.io 4.6.1**

Socket.io забезпечує двосторонню комунікацію в реальному часі:
- WebSocket з fallback на HTTP long-polling;
- автоматичне перепідключення;
- кімнати та простори імен;
- broadcast-повідомлення.

Використовується для:
- онлайн-чату підтримки;
- сповіщень у реальному часі;
- оновлення статусу замовлень.

### 3.1.10 Автентифікація та безпека

**Passport.js 0.7.0 + JWT**

Система автентифікації побудована на Passport.js з JWT-стратегією:
- Local Strategy — автентифікація за email/паролем;
- JWT Strategy — перевірка токенів доступу;
- bcryptjs 2.4.3 — хешування паролів;
- Refresh tokens — оновлення токенів доступу.

**Захист від OWASP Top 10:**
- SQL Injection — параметризовані запити TypeORM;
- XSS — автоматичне екранування React;
- CSRF — CORS та перевірка origin;
- Broken Authentication — JWT з обмеженим терміном дії.

### 3.1.11 Платіжна система

**Stripe 20.0.0**

Stripe використовується для обробки онлайн-платежів:
- Stripe Elements для безпечного введення карткових даних;
- Payment Intents API для керування платежами;
- Webhooks для підтвердження оплати;
- PCI DSS Level 1 сумісність.

Клієнтські бібліотеки:
- @stripe/stripe-js 8.5.2 — JavaScript SDK;
- @stripe/react-stripe-js 5.4.0 — React-компоненти.

### 3.1.12 Email та сповіщення

**Nodemailer 6.9.8**

Nodemailer використовується для надсилання email-повідомлень:
- підтвердження реєстрації;
- відновлення паролю;
- сповіщення про замовлення;
- нагадування про покинуті кошики.

**Handlebars 4.7.8**

Handlebars — шаблонізатор для HTML-листів з підтримкою:
- змінних та виразів;
- умовних блоків;
- циклів та ітерацій.

**Mailpit** (середовище розробки)

Mailpit використовується для тестування email у локальному середовищі:
- веб-інтерфейс на порту 8025;
- SMTP-сервер на порту 1025;
- перехоплення всіх вихідних листів.

### 3.1.13 Інтеграція з месенджерами

**node-telegram-bot-api 0.66.0**

Telegram Bot API для сповіщень адміністраторів:
- сповіщення про нові замовлення;
- критичні помилки системи;
- статистика продажів.

**WhatsApp Cloud API**

Окремий мікросервіс для інтеграції з WhatsApp Business:
- сповіщення клієнтів про статус замовлень;
- автоматичні відповіді;
- маркетингові розсилки.

### 3.1.14 Моніторинг та логування

**Sentry 10.26.0**

Sentry використовується для моніторингу помилок:
- автоматичне відстеження винятків;
- контекст помилок (користувач, запит);
- performance monitoring;
- release tracking.

Модулі:
- @sentry/nestjs 10.26.0 — інтеграція з NestJS;
- @sentry/profiling-node 10.26.0 — профілювання продуктивності.

### 3.1.15 Валідація даних

**class-validator 0.14.1 + class-transformer 0.5.1**

Валідація вхідних даних на рівні API:
- декоратори для визначення правил валідації;
- автоматична трансформація типів;
- кастомні валідатори;
- глобальний ValidationPipe в NestJS.

**Zod 3.22.4**

Валідація на рівні клієнтських застосунків та спільних типів:
- TypeScript-first схеми;
- автоматичне виведення типів;
- парсинг та валідація даних.

### 3.1.16 Тестування

**Jest 29.x**

Jest — основний фреймворк для тестування:
- модульні тести;
- інтеграційні тести;
- coverage reports;
- snapshot testing.

Додаткові інструменти:
- ts-jest 29.1.1 — підтримка TypeScript;
- @nestjs/testing 10.3.0 — тестування NestJS-модулів;
- React Test Renderer 19.1.1 — тестування React Native.

### 3.1.17 Інструменти якості коду

**ESLint 8.56.0**

ESLint забезпечує статичний аналіз коду:
- виявлення потенційних помилок;
- дотримання стилю коду;
- TypeScript-специфічні правила.

Плагіни:
- @typescript-eslint/parser 6.19.0;
- @typescript-eslint/eslint-plugin 6.19.0.

**Prettier 3.2.4**

Prettier — форматувальник коду:
- автоматичне форматування;
- інтеграція з ESLint;
- підтримка багатьох форматів файлів.

Конфігурація:
```json
{
  "semi": false,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 80
}
```

### 3.1.18 Контейнеризація та розгортання

**Docker**

Docker використовується для контейнеризації сервісів:
- ізоляція середовища виконання;
- відтворюваність builds;
- простота розгортання.

Dockerfile'и використовують multi-stage builds для оптимізації:
1. **base** — встановлення pnpm;
2. **dependencies** — встановлення залежностей;
3. **build** — компіляція TypeScript;
4. **production** — фінальний образ.

**Docker Compose**

Docker Compose оркеструє багатоконтейнерне середовище:

| Сервіс | Образ | Порт | Призначення |
|--------|-------|------|-------------|
| PostgreSQL | postgres:16-alpine | 10050 | База даних |
| Redis | redis:7-alpine | 10100 | Кеш та черги |
| Elasticsearch | elasticsearch:8.11.0 | 9200 | Пошук |
| Mailpit | mailpit | 8025/1025 | Email (dev) |
| API | node:20-alpine | 10001 | Backend |
| Web | node:20-alpine | 10002 | Frontend |

**Nginx**

Nginx використовується як reverse proxy:
- маршрутизація запитів до сервісів;
- SSL/TLS термінація;
- статичні файли;
- load balancing.

### 3.1.19 Обробка даних

**PapaParse 5.4.1**

PapaParse використовується для імпорту CSV-файлів:
- парсинг великих файлів;
- потокова обробка;
- автоматичне визначення типів.

**Multer 1.4.5-lts.1**

Multer — middleware для завантаження файлів:
- обробка multipart/form-data;
- конфігурація збереження файлів;
- валідація типів та розмірів.

### 3.1.20 HTTP-клієнт

**Axios 1.6.x**

Axios використовується для HTTP-запитів на всіх платформах:
- Promise-based API;
- interceptors для токенів та помилок;
- автоматична серіалізація JSON;
- підтримка скасування запитів.

### 3.1.21 Інтернаціоналізація

Мобільний застосунок підтримує локалізацію:
- українська мова (uk);
- англійська мова (en).

Локалізаційні файли розташовані в `apps/mobile_cool/src/i18n/`.

### 3.1.22 Зведена таблиця технологій

Таблиця 3.1 — Основні технології системи FullMag

| Категорія | Технологія | Версія | Призначення |
|-----------|------------|--------|-------------|
| Мова | TypeScript | 5.3.3 | Основна мова розробки |
| Runtime | Node.js | >=20.0.0 | Середовище виконання |
| Package Manager | pnpm | 10.23.0 | Управління залежностями |
| Backend Framework | NestJS | 10.3.0 | Серверний фреймворк |
| Web Framework | Next.js | 14.1.0 | Веб-застосунок |
| Mobile Framework | React Native | 0.82.1 | Мобільний застосунок |
| UI Library | React | 18.2.0 / 19.1.1 | Користувацький інтерфейс |
| Database | PostgreSQL | 16 | Реляційна БД |
| ORM | TypeORM | 0.3.19 | Object-Relational Mapping |
| Cache | Redis | 7 | Кешування |
| Search | Elasticsearch | 8.11.0 | Повнотекстовий пошук |
| Queue | Bull | 4.12.0 | Черги завдань |
| Real-time | Socket.io | 4.6.1 | WebSocket комунікація |
| Auth | Passport + JWT | 0.7.0 | Автентифікація |
| Payments | Stripe | 20.0.0 | Обробка платежів |
| Email | Nodemailer | 6.9.8 | Email-розсилки |
| Monitoring | Sentry | 10.26.0 | Моніторинг помилок |
| CSS | Tailwind CSS | 3.4.1 | Стилізація (web) |
| State (Web) | Zustand | 4.5.0 | Управління станом |
| State (Mobile) | Redux Toolkit | 2.10.1 | Управління станом |
| Testing | Jest | 29.x | Тестування |
| Linting | ESLint | 8.56.0 | Аналіз коду |
| Formatting | Prettier | 3.2.4 | Форматування коду |
| Containerization | Docker | - | Контейнеризація |
| Orchestration | Docker Compose | 3.8 | Оркестрація контейнерів |
| Reverse Proxy | Nginx | alpine | Проксі-сервер |

### 3.1.23 Структура проекту

```
fullmag/
├── apps/
│   ├── web/                    # Next.js веб-застосунок
│   │   ├── src/
│   │   │   ├── app/           # App Router сторінки
│   │   │   ├── components/    # React компоненти
│   │   │   ├── lib/           # Утиліти та сервіси
│   │   │   └── styles/        # Tailwind стилі
│   │   ├── public/            # Статичні файли
│   │   └── Dockerfile
│   └── mobile_cool/           # React Native застосунок
│       ├── src/
│       │   ├── screens/       # Екрани застосунку
│       │   ├── components/    # UI компоненти
│       │   ├── navigation/    # Навігація
│       │   ├── store/         # Redux store
│       │   ├── services/      # API сервіси
│       │   └── i18n/          # Локалізація
│       └── android/ios/       # Нативний код
├── services/
│   ├── api/                   # NestJS API сервіс
│   │   ├── src/
│   │   │   ├── modules/       # Функціональні модулі
│   │   │   ├── database/      # Сутності та міграції
│   │   │   ├── gateways/      # WebSocket гейтвеї
│   │   │   └── templates/     # Email шаблони
│   │   └── Dockerfile
│   └── whatsapp/              # WhatsApp мікросервіс
├── packages/
│   └── common/                # Спільні типи та утиліти
├── infra/                     # Інфраструктурні конфігурації
├── nginx/                     # Nginx конфігурація
├── docker-compose.yml         # Docker Compose для розробки
└── docker-compose.prod.yml    # Docker Compose для production
```

### 3.1.24 Порти та сервіси

Таблиця 3.2 — Конфігурація портів системи

| Сервіс | Порт | Опис |
|--------|------|------|
| API (NestJS) | 10001 | REST API та WebSocket |
| Web (Next.js) | 10002 | Веб-застосунок |
| Mobile Metro | 10050 | Metro bundler |
| PostgreSQL | 10050 | База даних |
| Redis | 10100 | Кеш та черги |
| Elasticsearch | 9200 | Пошукова система |
| Mailpit Web UI | 8025 | Email тестування |
| Mailpit SMTP | 1025 | SMTP сервер |

### 3.1.25 Висновки до підрозділу

Обрані інструменти та технології забезпечують:

1. **Продуктивність розробки** — TypeScript, NestJS та React забезпечують швидку розробку з мінімальною кількістю помилок завдяки статичній типізації.

2. **Масштабованість** — мікросервісна архітектура, Redis для кешування та Bull для черг дозволяють системі масштабуватися горизонтально.

3. **Кросплатформність** — спільна кодова база для веб та мобільних платформ через React та React Native знижує витрати на підтримку.

4. **Безпека** — JWT-автентифікація, bcrypt-хешування паролів, CORS та захист від OWASP Top 10 забезпечують надійний захист даних.

5. **Зручність розгортання** — Docker та Docker Compose спрощують налаштування середовищ розробки та production.

6. **Якість коду** — ESLint, Prettier та Jest забезпечують дотримання стандартів коду та покриття тестами.
